<template name="elementDetails">
    <div class="container">
        {{#if Template.subscriptionsReady}}
            {{#with element}}
            <div class="row">
                <div class="col-xs-2">
                    <a href="/elements" class="btn btn-default"><i class="fa fa-chevron-left" aria-hidden="true"></i> Voltar</a>
                </div>
                <div class="col-xs-10">
                    <span class="pull-right">
                        {{#if manager}}
                            <button class="btn btn-primary js-showEditElementModal">Editar</button>
                        {{/if}}
                        {{#if formType.hasCalibration }}
                            <button class="btn btn-success js-addActionModal">Calibração</button>
                        {{/if}}
                        {{#if formType.hasSetpoint }}
                            <button class="btn btn-success js-addActionModal">Verificação</button>
                        {{/if}}
                        {{#if formType.hasMaintenance }}
                            <button class="btn btn-success js-addActionModal">Manutenção</button>
                        {{/if}}
                    </span>
                </div>
            </div>
            <hr/>
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-bordered">
                        <thead>
                            <tr><td colspan="2"><h4>Detalhes do(a) {{elementType}}</h4></td></tr>
                        </thead>
                        <tbody>
                            <tr><td>Numero:</td><td><strong>{{elementId}}</strong></td></tr>
                            <tr><td>Marca:</td><td>{{manufacturer}}</td></tr>
                            <tr><td>Modelo:</td><td>{{model}}</td></tr>
                            <tr><td>Número Série:</td><td>{{serialNumber}}</td></tr>
                            <tr><td>Localização:</td><td>{{location}}</td></tr>
                            <tr><td>Uso:</td><td>{{use}}</td></tr>
                            <tr><td>Data de compra:</td><td>{{purchasingDate}}</td></tr>
                            {{#if formType.hasCalibration }}
                                <tr><td>Limite Inferior:</td><td>{{bottomLimit}}</td></tr>
                                <tr><td>Classe de precisão:</td><td>{{precisionClass}}</td></tr>
                                <tr><td>Gama de medida:</td><td>{{rangeMeasure}}</td></tr>
                                <tr><td>Gama de uso:</td><td>{{rangeUse}}</td></tr>
                                <tr><td>Escala:</td><td>{{scale}}</td></tr>
                                <tr><td>Resolução:</td><td>{{resolution}}</td></tr>
                                <tr><td>Unidades:</td><td>{{units}}</td></tr>
                                <tr><td>Critério de Não Conformidade:</td><td>{{noConform}}</td></tr>
                                <tr><td>Valor de Não Conformidade:</td><td>{{noConformValue}}</td></tr>
                                <tr><td>Digital:</td><td>{{isDigitalTranslated}}</td></tr>
                                <tr><td colspan="2">OBS: {{memo}}</td></tr>
                            {{/if}}
                            {{#if formType.hasSetpoint }}
                                <tr><td>Disparo / Setpoint:</td><td>{{setPoint}}</td></tr>
                                <tr><td>Gama de medida:</td><td>{{rangeMeasure}}</td></tr>
                                <tr><td>Unidades:</td><td>{{units}}</td></tr>
                                <tr><td>Critério de Não Conformidade:</td><td>{{noConform}}</td></tr>
                                <tr><td>Valor de Não Conformidade:</td><td>{{noConformValue}}</td></tr>                                
                                <tr><td colspan="2">OBS: {{memo}}</td></tr>
                            {{/if}}
                            {{#if formType.hasMaintenance }}
                                <tr><td>Capacidade:</td><td>{{capacity}}</td></tr>
                                <tr><td>Fornecedor:</td><td>{{supplier}}</td></tr>
                                <tr><td>Consumíveis:</td><td>{{supplies}}</td></tr>
                                <tr><td colspan="2">OBS: {{memo}}</td></tr>
                            {{/if}}
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                {{#if hasPeriodicity}}
                    {{#if formType.hasCalibration }}
                        {{#if isOnTime }}
                            <div class="alert alert-success" role="alert">
                                <h3>Estado calibração: <strong>Feita</strong></h3>
                                <p>Próxima calibração: </p>
                                <p>Frequência calibração: <strong>{{frequencyMonths}} Meses</strong></p>
                            </div>
                        {{else}}
                            <div class="alert alert-danger" role="alert">
                                <h3>Estado calibração: <strong>Por fazer</strong></h3>
                                <p>Calibração expirou em: </p>
                                <p>Frequência calibração: <strong>{{frequencyMonths}} Meses</strong></p>
                            </div>
                        {{/if}}
                    {{/if}}
                    {{#if formType.hasSetpoint }}
                        {{#if isOnTime }}
                            <div class="alert alert-success" role="alert">
                                <h3>Estado verificação: <strong>Feita</strong></h3>
                                <p>Próxima verificação: </p>
                                <p>Frequência verificação: <strong>{{frequencyMonths}} Meses</strong></p>
                            </div>
                        {{else}}
                            <div class="alert alert-danger" role="alert">
                                <h3>Estado verificação: <strong>Por fazer</strong></h3>
                                <p>Verificação expirou em: </p>
                                <p>Frequência verificação: <strong>{{frequencyMonths}} Meses</strong></p>
                            </div>
                        {{/if}}
                    {{/if}}
                    {{#if formType.hasMaintenance }}
                        {{#if isOnTime }}
                            <div class="alert alert-success" role="alert">
                                <h3>Estado manutenção: <strong>Feita</strong></h3>
                                <hr/>
                                <p>Próxima manutenção: <strong>{{nextActionDate}}</strong>{{#if nextActionHours}} ou <strong>{{nextActionHours}}</strong> Horas.{{/if}}</p>
                                <hr/>
                                {{#if frequencyHours}}
                                    <p>Frequência Manutenção (o que atingir primeiro): <strong>{{frequencyMonths}} Meses</strong> ou <strong>{{frequencyHours}} Horas</strong> de operação</p>
                                {{else}}
                                    <p>Frequência Manutenção: <strong>{{frequencyMonths}} Meses</strong></p>
                                {{/if}}
                            </div>                                
                        {{else}}
                            <div class="alert alert-danger" role="alert">
                                <h3>Estado manutenção: <strong>Por fazer</strong></h3>
                                <p>Manutenção expirou em: <strong>{{nextActionDate}}</strong></p>
                                {{#if frequencyHours}}
                                    <p>Frequência Manutenção (o que atingir primeiro): <strong>{{frequencyMonths}} Meses</strong> ou <strong>{{frequencyHours}} Horas</strong> de operação</p>
                                {{else}}
                                    <p>Frequência Manutenção: <strong>{{frequencyMonths}} Meses</strong></p>
                                {{/if}}
                            </div>
                        {{/if}}
                        {{#if actionsForThisElement}}
                            <h3>Lista de manutenções</h3>
                            <div class="panel-group" id="actionsForThisElement" role="tablist" aria-multiselectable="true">
                                {{#each actionsForThisElement}}
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="heading-{{_id}}">
                                        <h4 class="panel-title">
                                            <a role="button" data-toggle="collapse" data-parent="#actionsForThisElement" href="#collapse-{{_id}}" aria-expanded="true" aria-controls="collapse-{{_id}}">
                                                {{formatDate madeAt}}
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapse-{{_id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-{{_id}}">
                                        <div class="panel-body">
                                            <p>Tipo de manutenção: <strong>{{maintenanceType actionType}}</strong></p>
                                            <p>Horas de máquina: {{hours}}</p>
                                            <p>Descrição: {{description}}</p>
                                            <p>Custos de mão de obra: {{manCost}}</p>
                                            <p>Custos de peças: {{partsCost}}</p>
                                            <p>Folha de obra/serviço: {{serviceNote}}</p>
                                            <p>Factura: {{invoice}}</p>
                                        </div>
                                    </div>
                                </div>
                                {{/each}}
                            </div>
                        {{/if}}
                    {{/if}}
                {{else}} 
                    <!-- it means it has 0 or no value for the frequencyMonths field -->
                    <div class="alert alert-default" role="alert">
                        <p>Este equipamento não tem periodicidade definida.</p>
                    </div>                
                {{/if}}
                </div>
            </div>
            {{/with}}
        {{else}}
            <p>Loading...</p>
        {{/if}}
    </div>
</template>

<template name="editElementModal">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Editar Elemento</h4>
                </div>
                {{#autoForm collection=elements id='editElementForm' type='method-update' meteormethod='updateElement' doc=this singleMethodArgument=true}}
                <div class="modal-body">
                    {{#if duplicateAlert}}
                        <div class="alert alert-warning" role="alert">Atenção, o elemento com esse número já existe!</div>
                    {{/if}}
                    <div class="row">
                        {{> afQuickField name='elementType' formgroup-class="col-xs-7" disabled='true'}}
                        <div class="form-group col-xs-1">
                            <label class="control-label"></label>
                            <p class="form-control-static"><strong>{{ elementInitials }}</strong></p>
                        </div>
                        {{> afQuickField name='elementNumber' formgroup-class='col-xs-3'}}
                    </div>
                    <div class="row">
                        {{> afQuickField name='manufacturer' formgroup-class='col-xs-4'}}
                        {{> afQuickField name='model' formgroup-class='col-xs-4'}}
                        {{> afQuickField name='serialNumber' formgroup-class='col-xs-4'}}
                    </div>
                    {{#if formType.hasCalibration }}
                        <div class="row">
                            <div class="col-xs-4">
                                {{> afQuickField name='frequencyMonths' label='Freq. Calibração' placeholder='(Meses)'}}
                                {{> afQuickField name='bottomLimit'}}
                                {{> afQuickField name='precisionClass'}}
                                {{> afQuickField name='rangeMeasure'}}
                                {{> afQuickField name='rangeUse'}}
                                {{> afQuickField name='scale' }}
                                {{> afQuickField name='resolution'}}
                            </div>
                            <div class="col-xs-8">
                                {{> afQuickField name='location'}}
                                {{> afQuickField name='use'}}
                                {{> afQuickField name='noConform'}}
                                {{> afQuickField name='noConformValue' placeholder='Numero'}}
                                {{> afQuickField name='purchasingDate' }}
                                {{> afQuickField name='units' }}
                                {{> afQuickField name='isDigital' }}
                            </div>
                        </div>
                    {{/if}}
                    {{#if formType.hasSetpoint}}
                        <div class="row">
                            <div class="col-xs-4">
                                {{> afQuickField name='frequencyMonths' label='Freq. Verificação' placeholder='(Meses)'}}
                                {{> afQuickField name='rangeMeasure'}}
                                {{> afQuickField name='setPoint' placeholder='Numero'}}
                                {{> afQuickField name='noConformValue' placeholder='Percentagem permitida'}}
                                {{> afQuickField name='purchasingDate' }}
                            </div>
                            <div class="col-xs-8">
                                {{> afQuickField name='location'}}
                                {{> afQuickField name='use'}}
                                {{> afQuickField name='units' }}
                                {{> afQuickField name='noConform'}}
                            </div>
                        </div>
                    {{/if}}
                    {{#if formType.hasMaintenance }}
                        <div class="row">
                            <div class="col-xs-4">
                                {{> afQuickField name='frequencyMonths' label='Freq. Revisão' placeholder='(Meses)'}}
                                {{> afQuickField name='frequencyHours' label='Freq. Revisão' placeholder='(Horas)'}}
                                {{> afQuickField name='purchasingDate' }}
                            </div>
                            <div class="col-xs-8">
                                {{> afQuickField name='use'}}
                                {{> afQuickField name='location'}}
                                {{> afQuickField name='capacity' }}
                            </div>
                        </div>
                    {{/if}}
                </div>
            
                <div class="modal-footer">
                    {{#if manager}}
                        <button type="button" class="btn btn-danger js-removeElement" data-dismiss="modal">Eliminar Elemento</button>
                    {{/if}}
                    <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
                {{/autoForm}}
            </div>
        </div>
    </div>
</template>

<template name="addActionModal">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    {{#if formType.hasCalibration }}
                        <h4 class="modal-title">Adicionar Calibração</h4>
                    {{/if}}
                    {{#if formType.hasSetpoint }}
                        <h4 class="modal-title">Adicionar Verificação</h4>
                    {{/if}}
                    {{#if formType.hasMaintenance }}
                        <h4 class="modal-title">Adicionar Manutenção</h4>
                    {{/if}}
                </div>
                {{#autoForm collection=actions id='insertActionForm' type='method' meteormethod='insertAction' singleMethodArgument=true}}
                <div class="modal-body">
                        <div class="row">
                            {{> afQuickField name='madeAt' label='Data' formgroup-class='col-md-4'}}
                        </div>
                        {{#if formType.hasMaintenance }}
                            <div class="row">
                                {{> afQuickField name='hours' formgroup-class='col-md-4'}}
                                {{> afQuickField name='actionType' type='select' options=actionTypeOptions firstOption=false formgroup-class='col-md-8'}}
                            </div>
                            <div class="row">
                                {{> afQuickField name='description' formgroup-class='col-md-12'}}
                            </div>
                            <div class="row">
                                {{> afQuickField name='partsUsed' formgroup-class='col-md-12'}}
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    {{> afQuickField name='manCost'}}
                                    {{> afQuickField name='partsCost'}}
                                </div>
                                <div class="col-md-8">
                                    {{> afQuickField name='serviceNote'}}
                                    {{> afQuickField name='invoice'}}
                                </div>
                            </div>
                        {{/if}}                        
                        
                
                </div>
            
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
                {{/autoForm}}
            </div>
        </div>
    </div>
</template>